

@{
    Layout = null;
}

<!DOCTYPE html>
<script src="~/Scripts/jquery-1.10.2.js"></script>
<script src="~/Scripts/jquery.validate.js"></script>
<script src="~/Scripts/jquery.validate.unobtrusive.js"></script>
<html>
<head>
    <link href="~/Content/bootstrap.css" rel="stylesheet" />
    <meta name="viewport" content="width=device-width" />
    <title>Profits</title>
</head>
<body>
    <div>
        <h1><span style="color:#375a7f">Order List:</span></h1>
        <table id="OrdersTable" class="table table-striped table-hover ">
            <colgroup>
                <col style="width:80px">
                <col style="width:50px">
            </colgroup>
            <tr>
                <td>OrderID:</td>
                <td>Date:</td>
                <td>TotalPrice:</td>
            </tr>
        </table>
        <br />
        <div id="TblStatus"></div>
        <br />
        <table class="table table-striped table-hover ">
            <colgroup>
                <col style="width:190px">
            </colgroup>
            <tr>
                <td>
                    Total Profit:
                </td>
                <td>
                    <input id="total" value="0" readonly="readonly" style="width: 73px;" />
                </td>
            </tr>
            <tr>
                <td>
                    <input type="button" value="Return" class="btn btn-primary btn-xs" onclick="@("window.location.href='" + @Url.Action("ManagerHome", "Manager") + "'");" />
                </td>
            </tr>
        </table>
    </div>
</body>
</html>
<script language="javascript">
    $("#TblStatus").text("Loading..");
    $.get("GetCompletedOrdersByJson", null, BindData);
    var total = 0;
    function BindData(Orders)
    {
        
        $("#OrdersTable").find("tr:gt(0)").remove();//delete all rows besides the first
        var table = $("#OrdersTable");
        for (i = 0; i < Orders.length; i++)
        {
            var row = "<tr>" +
                "<td>" + Orders[i].OID + "</td>" +
                "<td>" + ConvertDateFromJson(Orders[i].Orderdate) + "</td>" +
                "<td>" + Orders[i].Totalprice + "</td>" +
                "</tr>";
            total += Orders[i].Totalprice;
            table.append(row);
        }
        total = total.toFixed(2);
        $("#total").val(total);
        $("#TblStatus").text("");

    }
    function ConvertDateFromJson(value)
    {
        var pattern = /Date\(([^)]+)\)/;
        var results = pattern.exec(value);
        var dt = new Date(parseFloat(results[1]));
        return (dt.getMonth() + 1) + "/" + dt.getDate() + "/" + dt.getFullYear();
    }
</script>

