@model Project.Models.Customer

@{
    Layout = null;
}

<!DOCTYPE html>
<script src="~/Scripts/jquery-1.10.2.js"></script>
<script src="~/Scripts/jquery.validate.js"></script>
<script src="~/Scripts/jquery.validate.unobtrusive.js"></script>
<html>
<head>
    <link href="~/Content/bootstrap.css" rel="stylesheet" />
    <meta name="viewport" content="width=device-width" />
    <title>Registration Form</title>
</head>
<body>
    <div>
        <div>
            <h1> <span style="color:#375a7f">Current Products:</span></h1>
            <br />
            <table id="ProductsTable" class="table table-striped table-hover ">
                <colgroup>
                    <col style="width:150px">
                </colgroup>
                <tr>
                    <td>Product</td>
                    <td>Price</td>
                </tr>
            </table>
            <br />
            <div id="TblStatus"></div>
        </div>
        <br />
        <div id="msg"></div>
        <br/>
        <br />
        <div id="AddStatus"></div>
        <br />
        <h2><span style="color:#375a7f">Registration Form:</span></h2>
        
        <form id="regForm">
            <table class="table table-striped table-hover ">
                <colgroup>
                    <col style="width:190px">
                </colgroup>
                <tr>

                    <td>
                        ID:
                    </td>
                    <td>
                        @Html.TextBoxFor(m => m.ID, new { name = "id" }) @Html.ValidationMessageFor(x => x.ID)
                    </td>

                </tr>
                <tr>
                    <td>
                        Name:
                    </td>
                    <td>
                        @Html.TextBoxFor(m => m.Name, new { name = "name" }) @Html.ValidationMessageFor(x => x.Name)
                    </td>
                </tr>
                <tr>
                    <td>
                        Password:
                    </td>
                    <td>
                        @Html.PasswordFor(m => m.Password, new { name = "password" }) @Html.ValidationMessageFor(x => x.Password)
                    </td>
                <tr>
                    <td>
                        <input type="button" value="Return" class="btn btn-primary btn-xs" onclick="@("window.location.href='" + @Url.Action("Home", "Home") + "'");" />
                    </td>
                    <td>
                        <input id="Submit" class="btn btn-primary btn-xs" type="button" value="Submit" onclick="PostData()" />
                    </td>
                </tr>

            </table>

        </form>
        
        
        
    </div>
</body>
</html>
<script language="javascript">
    $("#TblStatus").text("Loading..");
    $.ajax({//instead of $.get
        url: '/Manager/GetProductsByJson',
        data: { Msg: "" },
        success: BindData
    });
    function BindData(json) {
        $("#ProductsTable").find("tr:gt(0)").remove();//delete all rows besides the first
        var table = $("#ProductsTable");
        for (i = 0; i < json.Products.length; i++) {
            var row = "<tr>" +
                "<td>" + json.Products[i].Name + "</td>" +
                "<td>" + json.Products[i].Price + "</td>" +
                "</tr>";
            table.append(row);
        }
        $("#TblStatus").text("");
    }
    function PostData()
    {
        if ($("#Name").val().length > 0 && $("#Password").val().length > 0 && $("#ID").val().length > 0) {
            $("#AddStatus").text("Processing....");
            var tabPom = document.getElementById("Submit");
            $(tabPom).prop('disabled', true);
            var formData = $("#regForm").serialize();//step 1 and 2
            $.post("Registration", formData, check);//step 3
        }
        else
            check("All fields are required!");

    }
    function check(msg)
    {
        if (msg == "")
            window.location.href = "/User/Authenticate";
        else {
            alert(msg);
            var tabPom = document.getElementById("Submit");
            $(tabPom).prop('disabled', false);
            $("#AddStatus").text("");
        }
        $("#Password").val("");
    }



</script>
