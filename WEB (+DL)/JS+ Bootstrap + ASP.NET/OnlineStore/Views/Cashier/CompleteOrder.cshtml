

@{
    Layout = null;
}

<!DOCTYPE html>
<script src="~/Scripts/jquery-1.10.2.js"></script>
<script src="~/Scripts/jquery.validate.js"></script>
<script src="~/Scripts/jquery.validate.unobtrusive.js"></script>
<html>
<head>
    <link href="~/Content/bootstrap.css" rel="stylesheet" />
    <meta name="viewport" content="width=device-width" />
    <title>CompleteOrder</title>
</head>
<body>
    <div>
        <h1><span style="color:#375a7f">Order List:</span></h1>
        <table id="OrdersTable" class="table table-striped table-hover ">
            <colgroup>
                <col style="width:80px">
                <col style="width:50px">
            </colgroup>
            <tr>
                <td>OrderID:</td>
                <td>Date:</td>
                <td>TotalPrice:</td>
            </tr>
        </table>
        <br />
        <div id="TblStatus"></div>
        <br />
        <h2><span style="color:#375a7f">Complete Order:</span></h2>
        <div id="msg"></div>

        <table class="table table-striped table-hover ">
            <colgroup>
                <col style="width:190px">
            </colgroup>
            <tr>
                <td>
                    Select Order:
                </td>
                <td>
                    <select id="OrdersSelect" style="color:gray"></select>
                </td>

            <tr>
                <td>
                    <input type="button" value="Return" class="btn btn-primary btn-xs" onclick="@("window.location.href='" + @Url.Action("CashierHome", "Cashier") + "'");" />
                </td>
                <td>
                    <input id="Submit" class="btn btn-primary btn-xs" type="button" value="Complete" onclick="PostData()" />
                </td>
            </tr>

        </table>


        <br />
        <div id="AddStatus"></div>
        <br />
    </div>
</body>
</html>
<script language="javascript">
    $("#TblStatus").text("Loading..");
    $.get("GetOpennedOrdersByJson", null, BindData);
    function BindData(Orders)
    {
        
        $("#OrdersTable").find("tr:gt(0)").remove();//delete all rows besides the first
        $("#Orders").find("tr:gt(0)").remove();//delete all rows besides the first
        var table = $("#OrdersTable");
        var selected = $("#OrdersSelect")
        for (i = 0; i < Orders.length; i++)
        {
            var row = "<tr>" +
                "<td>" + Orders[i].OID + "</td>" +
                "<td>" + ConvertDateFromJson(Orders[i].Orderdate) + "</td>" +
                "<td>" + Orders[i].Totalprice + "</td>" +
                "</tr>";
            var option;
            if (i == 0)
                option = "<option id=" + "''" + +Orders[i].OID + "''" + " value=" + "''" + Orders[i].OID + "''" + " selected=" + "''" + "selected" + "''" + ">" + Orders[i].OID + "</option>";
            else
                option = "<option id=" + "''" + +Orders[i].OID + "''" + " value=" + "''" + Orders[i].OID + "''" + ">" + Orders[i].OID + "</option>";
            table.append(row);
            selected.append(option);
        }
        $("#TblStatus").text("");

    }
    function ConvertDateFromJson(value)
    {
        var pattern = /Date\(([^)]+)\)/;
        var results = pattern.exec(value);
        var dt = new Date(parseFloat(results[1]));
        return (dt.getMonth() + 1) + "/" + dt.getDate() + "/" + dt.getFullYear();
    }
    function PostData()
    {
        $("#AddStatus").text("Processing....");
        var sub = document.getElementById("Submit");
        $(sub).prop('disabled', true);
        var Data = document.getElementById("OrdersSelect");
        Data=parseInt(Data.options[Data.selectedIndex].text);
        $.post("/Cashier/CompleteOrder", { oid: Data });
        window.location.href = "/Cashier/CashierHome";
    }
</script>

